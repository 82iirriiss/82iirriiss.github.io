<!DOCTYPE html>
<html lang="en" dir="auto"> <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=no"> <meta name="description" content="NGINX 웹 서버와 연동 2004년 러시아에서 만든 무료 오픈소스 웹서버 아파치보다 동시처리 능력을 높이고 메모리를 적게 사용 NGINX와 장고 사이에서 WAS 역할을 하는 uWSGI 모듈과 gunicorn이 있으나, 대부분 uWSGI를 사용 1. 장고 설정 변..."> <meta name="revised" content="bd0a765f0a21ff3dd0114128ca8b2b6619a4a41b"> <meta name="author" content="82iirriiss"> <meta name="generator" content="jekyll-rtd-theme v2.0.10">
<meta name="theme-color" content="#2980b9"> <title>NGINX 웹 서버와 연동 · 윤미의 개발 블로그</title> <meta name="twitter:title" content="NGINX 웹 서버와 연동 · 윤미의 개발 블로그"> <meta name="twitter:description" content="NGINX 웹 서버와 연동 2004년 러시아에서 만든 무료 오픈소스 웹서버 아파치보다 동시처리 능력을 높이고 메모리를 적게 사용 NGINX와 장고 사이에서 WAS 역할을 하는 uWSGI 모듈과 gunicorn이 있으나, 대부분 uWSGI를 사용 1. 장고 설정 변..."> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@82iirriiss"> <meta name="twitter:url" content="http://localhost:4000/python/NginxWebServerDeploy/nginxWebServerDeploy.html"> <meta name="twitter:creator" content="@jekyll-rtd-theme v2.0.10"> <meta property="og:title" content="NGINX 웹 서버와 연동 · 윤미의 개발 블로그"> <meta property="og:description" content="NGINX 웹 서버와 연동 2004년 러시아에서 만든 무료 오픈소스 웹서버 아파치보다 동시처리 능력을 높이고 메모리를 적게 사용 NGINX와 장고 사이에서 WAS 역할을 하는 uWSGI 모듈과 gunicorn이 있으나, 대부분 uWSGI를 사용 1. 장고 설정 변..."> <meta property="og:locale" content="en"> <meta property="og:url" content="http://localhost:4000/python/NginxWebServerDeploy/nginxWebServerDeploy.html"> <meta property="og:type" content="article"> <meta property="article:author" content="82iirriiss"> <meta property="article:published_time" content="2020-12-14T13:31:15+09:00"> <meta property="article:modified_time" content="2021-03-02T20:53:37+09:00"> <script type="application/ld+json"> { "@context": "https://schema.org", "@type": "Article", "mainEntityOfPage": { "@type": "WebPage", "@id": "http://localhost:4000/python/NginxWebServerDeploy/nginxWebServerDeploy.html" }, "headline": "NGINX 웹 서버와 연동 · 윤미의 개발 블로그", "image": [], "author": { "@type": "Person", "name": "82iirriiss" }, "datePublished": "2020-12-14T13:31:15+09:00", "dateModified": "2021-03-02T20:53:37+09:00", "publisher": { "@type": "User", "name": "82iirriiss", "logo": { "@type": "ImageObject", "url": "https://avatars.githubusercontent.com/u/59656683?v=4" } }, "description": "NGINX 웹 서버와 연동 2004년 러시아에서 만든 무료 오픈소스 웹서버 아파치보다 동시처리 능력을 높이고 메모리를 적게 사용 NGINX와 장고 사이에서 WAS 역할을 하는 uWSGI 모듈과 gunicorn이 있으나, 대부분 uWSGI를 사용 1. 장고 설정 변..." } </script> <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="canonical" href="http://localhost:4000/python/NginxWebServerDeploy/nginxWebServerDeploy.html">
<link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
<link rel="icon" type="image/png" href="/assets/images/favicon-16x16.png" sizes="16x16"> <link rel="icon" type="image/png" href="/assets/images/favicon-32x32.png" sizes="32x32"> <link rel="icon" type="image/png" href="/assets/images/favicon-96x96.png" sizes="96x96">
<link rel="mask-icon" href="/assets/images/favicon.svg" color="#2980b9">
<link rel="apple-touch-icon" href="/assets/images/apple-touch-icon-300x300.jpg"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/css/theme.min.css">
<script> window.ui = { title: "윤미의 개발 블로그", baseurl: "", i18n: { search_results: "Search Results", search_results_found: "Search finished, found # page(s) matching the search query.", search_results_not_found: "Your search did not match any documents, please make sure that all characters are spelled correctly!" } }; </script> </head> <body class="container">
<div class="sidebar-wrap overflow-hidden"> <div class="sidebar height-full overflow-y-scroll overflow-x-hidden"> <div class="header d-flex flex-column p-3 text-center"> <div class="title pb-1"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/" title="개발을 위한 기술을 정리함"> <i class="fa fa-home"></i> 윤미의 개발 블로그 </a> </div> <span class="version"></span> <form class="search pt-2" action="/search.html" method="get" autocomplete="off"> <input class="form-control input-block input-sm" type="text" name="q" placeholder="Search docs..."> </form> </div> <div class="toctree py-2" data-spy="affix" role="navigation" aria-label="main navigation"> <ul> </ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/python/"> Django &amp; Python </a><ul> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/tip/"> python 코딩 Tip! </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/tip/tip.html">1. 파이썬 코딩 시, 알아야 할 꿀팁!</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/webStandardLibrary/"> 웹 표준 라이브러리 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/webStandardLibrary/webClientLIbrary.html">1. 웹 클라이언트 라이브러리</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/webStandardLibrary/webServerLibrary.html">2. 웹 서버 라이브러리</a> </li> <li class="toc level-2 " data-sort="3" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/webStandardLibrary/CgiWsgiLibrary.html">3. CGI/WSGI 라이브러리</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/DjangoWebFramework/"> Django 웹 프레임워크 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebFramework/jangoInstall.html">1. 장고 프로그램 설치</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebFramework/jangoDevelopmentPattern.html">2. 장고의 웹애플리케이션 개발 방식</a> </li> <li class="toc level-2 " data-sort="3" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebFramework/applicationArchithect.html">3. 프로젝트 뼈대 만들기</a> </li> <li class="toc level-2 " data-sort="4" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebFramework/applicationDevelopment-Model.html">4. 애플리케이션 개발하기 - Model 코딩</a> </li> <li class="toc level-2 " data-sort="5" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebFramework/jangoDevelopment-View_Templete.html">5. 애플리케이션 개발하기 - URLconf, View 및 Templete 코딩</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/DjangoCoreFunction/"> Django 핵심기능 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoCoreFunction/decorateAdminSite.html">1. Admin 사이트 꾸미기</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoCoreFunction/dataAlterbyPythonShell.html">2. 장고 파이썬 쉘로 데이터 조작하기</a> </li> <li class="toc level-2 " data-sort="3" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoCoreFunction/templateSystem.html">3. 템플릿 시스템</a> </li> <li class="toc level-2 " data-sort="4" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoCoreFunction/DjangoForm.html">4. Django 의 폼 처리 기능</a> </li> <li class="toc level-2 " data-sort="5" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoCoreFunction/DjangoViewClass.html">5. 클래스 형 뷰</a> </li> <li class="toc level-2 " data-sort="6" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoCoreFunction/DjangoLogging.html">6. 로그 남기기</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/extendExampleProject/"> 실습예제 심화 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/extendExampleProject/addNewApplication.html">1. 새로운 애플리케이션 만들기</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/DjangoWebServerConfig/"> Django 웹서버 연동원리 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebServerConfig/wsgi_py_file.html">1. 장고의 wsgi.py 파일</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/DjangoWebServerConfig/jangoSettingCheckListInProductMode.html">2. 운영 서버 적용 전 장고의 설정 변경 사항</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/pythonAnyWhereCloudServerDeploy/"> Cloud (pythonanywhere) 서버에 Django 배포하기 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/pythonAnyWhereCloudServerDeploy/pythonanywhereDeploy.html">1. PythonAnyWhere에 장고소스 배포하기</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/ApacheWebServerDeploy/"> Apache 웹서버 연동하기 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/ApacheWebServerDeploy/apacheWebServerDeploy.html">1. 아파치 웹 서버와 연동</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/NginxWebServerDeploy/"> NGINX 웹서버와 연동하기 </a><ul> <li class="toc level-2 current" data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline current" href="/python/NginxWebServerDeploy/nginxWebServerDeploy.html">1. NGINX 웹 서버와 연동</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/JangoDevelopmentBasic/"> 파이썬 가상환경 사용하기 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/JangoDevelopmentBasic/jangoBasic.html">1. 가상환경 사용하기</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/developBookmark/"> bookmark 앱 개발 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/1_design.html">1. 설계</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/2_makeBorn.html">2. 개발 뼈대 세우기</a> </li> <li class="toc level-2 " data-sort="3" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/3_model.html">3. 모델 개발</a> </li> <li class="toc level-2 " data-sort="4" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/4_URLconf.html">4. URLconf 개발</a> </li> <li class="toc level-2 " data-sort="5" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/5_view.html">5. 뷰 개발</a> </li> <li class="toc level-2 " data-sort="6" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/6_templates.html">6. 템플릿 개발</a> </li> <li class="toc level-2 " data-sort="7" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBookmark/7_run.html">7. 결과물 확인</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/python/developBlog/"> bookmark 앱 개발 </a><ul> <li class="toc level-2 " data-sort="7" data-level="2"> <a class="d-flex flex-items-baseline " href="/python/developBlog/7_tag.html">7. Blog앱에 태그 달기</a> </li>
</ul> </li>
</ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/python-grammar/"> 파이썬 기본문법 </a><ul> <li class="toc level-1 " data-sort="1" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/gettingStart.html">1. 시작하기</a> </li> <li class="toc level-1 " data-sort="2" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/dataType.html">2. 자료형</a> </li> <li class="toc level-1 " data-sort="3" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/condition.html">3. 조건문</a> </li> <li class="toc level-1 " data-sort="4" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/loop.html">4. 반복문</a> </li> <li class="toc level-1 " data-sort="5" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/function.html">5. 함수</a> </li> <li class="toc level-1 " data-sort="6" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/exeption.html">6. 예외처리</a> </li> <li class="toc level-1 " data-sort="7" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/module.html">7. 모듈</a> </li> <li class="toc level-1 " data-sort="8" data-level="1"> <a class="d-flex flex-items-baseline " href="/python-grammar/class.html">8. 클래스</a> </li>
</ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/spring5/"> 스프링5 </a><ul> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/1_env/"> 개발환경 구축 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/1_env/env.html">1. 스프링 개발환경 구축</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/1_env/di_lombok.html">2. 의존성 주입 / Lombok</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/2_mvc/"> 스프링 MVC 설정 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/2_mvc/architect.html">1. 스프링 MVC 기본 설정</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/2_mvc/controller.html">2. 스프링 MVC의 Controller</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/3_webDev/"> 게시판 개발 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/1_architect.html">1. 프로젝트 패키지 구성, 네이밍, 설계</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/2_xmlSetting.html">2. xml 을 이용한 프로젝트 뼈대 설정</a> </li> <li class="toc level-2 " data-sort="3" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/3_javaSetting.html">3. Java Configuration 을 이용한 프로젝트 뼈대 설정</a> </li> <li class="toc level-2 " data-sort="4" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/4_persistence.html">4. 영속계층(DB, Mapper) 구현</a> </li> <li class="toc level-2 " data-sort="5" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/5_business.html">5. 비지니스 계층 (Service) 구현</a> </li> <li class="toc level-2 " data-sort="6" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/6_presentation.html">6. 프레젠테이션 계층(Controller) 구현</a> </li> <li class="toc level-2 " data-sort="7" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/7_ui.html">7. 화면 처리</a> </li> <li class="toc level-2 " data-sort="8" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/8_paging.html">8. 페이징 처리</a> </li> <li class="toc level-2 " data-sort="9" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/9_search.html">9. 검색 처리</a> </li> <li class="toc level-2 " data-sort="11" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/3_webDev/11_test.html">11. 테스트</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/4_rest_ajsx_reply/"> REST 방식과 Ajax 를 이용하는 댓글 처리 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/4_rest_ajsx_reply/1_rest_anotation.html">1. REST 방식</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/4_rest_ajsx_reply/2_reply_example.html">2. Ajax 댓글 달기 예제</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/5_aop_transaction/"> AOP와 트랜젝션 </a><ul> </ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/6_fileUpload/"> 파일 업로드 처리 </a><ul> </ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/7_security/"> 스프링 웹 시큐리티 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/1_setting.html">1. Spring Security 설정</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/2_loginlogout.html">2. 로그인과 로그아웃 처리 (security-context 설정과 로그인 관련 Handler 사용법)</a> </li> <li class="toc level-2 " data-sort="3" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/3_authWithJdbc.html">3. JDBC의 인증/권한 데이터와 시큐리티 연결하기</a> </li> <li class="toc level-2 " data-sort="4" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/4_authWithUserDetailsService.html">4. 커스텀 UserDetailsService 활용(최종적으로 사용해야 할 인증방식)</a> </li> <li class="toc level-2 " data-sort="5" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/5_jspWithSecurityTaglib.html">5. JSP 에서 시큐리티 태그 사용하기</a> </li> <li class="toc level-2 " data-sort="6" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/6_remember_me.html">6. 자동로그인 (remember-me)</a> </li> <li class="toc level-2 " data-sort="7" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/7_summary.html">7. 스프링 시큐리티 설정 요약</a> </li> <li class="toc level-2 " data-sort="8" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/7_security/8_applySecurityExistProject.html">8. 기존 프로젝트에 시큐리티 접목</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/8_intellij_gradle/"> Intellij와 gradle을 이용하는 스프링 환경 구축 </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/8_intellij_gradle/1_install.html">1. 설치</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/8_intellij_gradle/2_project.html">2. 프로젝트 생성</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/9_QNA/"> Q &amp; A </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/9_QNA/1_annotation.html">1. 어노테이션</a> </li> <li class="toc level-2 " data-sort="2" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/9_QNA/2_qna.html">2. Q&amp;A</a> </li>
</ul> </li> <li class="toc level-1"> <a class="d-flex flex-items-baseline" href="/spring5/10_mybatis/"> MyBatis </a><ul> <li class="toc level-2 " data-sort="1" data-level="2"> <a class="d-flex flex-items-baseline " href="/spring5/10_mybatis/1_myBatis.html">1. 마이바티스 동적 SQL</a> </li>
</ul> </li>
</ul> <a class="caption d-block text-uppercase no-wrap px-2 py-0" href="/springBoot/"> 스프링 부트 </a><ul> </ul> </div> </div> </div> <div class="content-wrap"> <div class="header d-flex flex-justify-between p-2 hide-lg hide-xl" aria-label="top navigation"> <button id="toggle" aria-label="Toggle menu" class="btn-octicon p-2 m-0 text-white" type="button"> <i class="fa fa-bars"></i> </button> <div class="title flex-1 d-flex flex-justify-center"> <a class="h4 no-underline py-1 px-2 rounded-1" href="/">윤미의 개발 블로그</a> </div> </div> <div class="content p-3 p-sm-5"> <div class="navigation-top d-flex flex-justify-between"> <ul class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation"> <li class="breadcrumb-item"> <a class="no-underline" href="/" title="/"> <i class="fa fa-home"></i> </a> </li>
<li class="breadcrumb-item"><a href="/python/">python</a></li>
<li class="breadcrumb-item"><a href="/python/NginxWebServerDeploy/">NginxWebServerDeploy</a></li>
<li class="breadcrumb-item" aria-current="page">nginxWebServerDeploy.md</li>
</ul> <a class="edit" href="https://github.com/82iirriiss/82iirriiss.github.io/edit/gh-pages/python/NginxWebServerDeploy/nginxWebServerDeploy.md" title="Edit on GitHub" rel="noreferrer" target="_blank"> <i class="fa fa-edit"></i> </a> </div> <hr> <div role="main" itemscope="itemscope" itemtype="https://schema.org/Article"> <div class="markdown-body" itemprop="articleBody"> <h1 id="nginx-웹-서버와-연동">NGINX 웹 서버와 연동</h1> <ul> <li>2004년 러시아에서 만든 무료 오픈소스 웹서버</li> <li>아파치보다 동시처리 능력을 높이고 메모리를 적게 사용</li> <li>NGINX와 장고 사이에서 WAS 역할을 하는 uWSGI 모듈과 gunicorn이 있으나, 대부분 uWSGI를 사용</li> </ul> <h2 id="1-장고-설정-변경하기">1. 장고 설정 변경하기</h2> <h3 id="1-리눅스-기본-설정">(1) 리눅스 기본 설정</h3> <ol> <li>리눅스에서 배포할 사용자로 로그인 ( 나의 경우, centos 사용자로 로그인)</li> <li>dnf (centos 패키지 관리프로그램) 업데이트 : <code class="language-plaintext highlighter-rouge notranslate">sudo dnf update</code>
</li> <li>python 설치 <code class="language-plaintext highlighter-rouge notranslate">$ sudo dnf install python3.*</code>
</li> <li>http, http-devel 설치 (작성 당시 2.4) <code class="language-plaintext highlighter-rouge notranslate">$ sudo dnf install http http-devel</code>
</li> <li>git 설치 <code class="language-plaintext highlighter-rouge notranslate">$ sudo dnf install git</code>
</li> </ol> <h3 id="2-python-가상환경-설정-및-장고-설치">(2) python 가상환경 설정 및 장고 설치</h3> <ol> <li>파이썬 가상환경을 만들 디렉토리 생성 <code class="language-plaintext highlighter-rouge notranslate">/home/centos&gt; mkdir VENV</code>
</li> <li>가상환경 디렉토리로 이동 후, 가상환경 설치 <div class="language-console highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="gp">/home/centos&gt;</span><span class="w"> </span><span class="nb">cd </span>VENV
<span class="gp">/home/contos&gt;</span><span class="w"> </span>virtualenv <span class="nt">--python</span> python3.6 v3PyBook 
</code></pre>  </div> </div> <ul> <li>‘python3.6'버전을 설치하며, 설치할 장소는 ‘v3PyBook' 으로 지정</li> </ul> </li> <li>가상환경 실행 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code>/home/centos&gt; source VENV/v3PyBook/bin/activate
(v3PyBook)/home/centos&gt;
</code></pre>  </div> </div> </li> <li>가상환경에서 Django 설치 (관리자 권한에서 설치) <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code>(v3PyBook)/home/centos&gt; su
password: [root 사용자 비밀번호 입력]
(v3PyBook)/home/centos&gt; pip install Django==2.0
</code></pre>  </div> </div> </li> </ol> <h2 id="2-프로젝트-설정-변경">2. 프로젝트 설정 변경</h2> <h3 id="1-프로젝트-다운로드">(1) 프로젝트 다운로드</h3> <ol> <li>프로젝트를 다운받을 디렉토리를 생성 후, 해당 디렉토리로 이동 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code>/home/centos&gt; mkdir pyBook
/home/centos&gt; cd pyBook
</code></pre>  </div> </div> </li> <li>
<strong>github</strong>에서 프로젝트를 다운로드 받는다. (교재의 소스를 다운받았다.) <code class="language-plaintext highlighter-rouge notranslate">/home/centos/pyBook&gt;git clone 'https://github.com/millni/Django-hanbit.git'</code>
</li> <li>프로젝트의 이름을 ‘ch8(임의의 이름)'으로 변경한다. <code class="language-plaintext highlighter-rouge notranslate">/home/centos/pyBook&gt;mv python-project ch8</code>
</li> </ol> <h3 id="2-프로젝트-settingspy-파일-변경">(2) 프로젝트 settings.py 파일 변경</h3> <p>. ch8/mysite/settings.py 파일</p> <ol> <li>DEBUG 모드 변경 : 운영모드로 전환 <div class="language-python highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="c1"># DEBUG = True
</span><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">False</span>
</code></pre>  </div> </div> </li> <li>ALLOWED_HOST 변경 : 아파치 서버의 ip (현재는 아파치와 프로젝트가 같은 PC 이므로 꼭 변경이 필요하지 않음) <div class="language-python highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="c1"># ALLOWED_HOST = ['localhost','127.0.0.1']
</span><span class="n">ALLOWED_HOST</span> <span class="o">=</span> <span class="p">[</span><span class="s">'192.168.111.100'</span><span class="p">,</span><span class="s">'localhost'</span><span class="p">,</span><span class="s">'127.0.0.1'</span><span class="p">]</span>
</code></pre>  </div> </div> </li> <li>STATIC_ROOT 경로 추가 <div class="language-python highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="n">STATIC_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'www_dir'</span><span class="p">,</span> <span class="s">'static'</span><span class="p">)</span>
</code></pre>  </div> </div> </li> </ol> <h3 id="3-static-파일-모으기">(3) STATIC 파일 모으기</h3> <p>. (가상환경에서 실행)</p> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight">
<pre class="highlight"><code>(v3PyBook)/home/centos/pyBook/ch8&gt; python manage.py collectstatic 
</code></pre>  </div></div> <h3 id="4-secret_key-변경--하드코딩---파일">(4) SECRET_KEY 변경 : 하드코딩 -&gt; 파일</h3> <ol> <li>settings.py 변경 <div class="language-python highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="c1"># SECRET_KEY = 어쩌구저쩌구~~
</span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'www_dir'</span><span class="p">,</span> <span class="s">'secret_key.txt'</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="n">SECRET_KEY</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
</code></pre>  </div> </div> </li> <li>secret_key.txt 파일 생성 후 키 입력 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code>/home/centos/pyBook/ch8/www_dir&gt; vim secret_key.txt
어쩌구저쩌구~~~
</code></pre>  </div> </div> </li> </ol> <h3 id="5-dbsqlite3-파일-위치-변경-및-migrate">(5) db.sqlite3 파일 위치 변경 및 migrate</h3> <ol> <li>settings.py 파일에서 DB 파일의 위치를 수정한다 <div class="language-python highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
 <span class="p">.</span> <span class="p">.</span> <span class="p">.</span>
 <span class="s">'NAME'</span><span class="p">:</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s">'db'</span><span class="p">,</span> <span class="s">'db.sqlite3'</span><span class="p">),</span>
<span class="p">}</span>
</code></pre>  </div> </div> </li> <li>ch8 아래 db 디렉토리를 생성 후 db.sqlite3을 옮긴다 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code>/home/centos/pyBook/ch8&gt; mkdir db
/home/centos/pyBook/ch8&gt; mv db.sqlite3 db/db.sqlite3
/hoem/centos/pyBook/ch8&gt; python manage.py migrate
</code></pre>  </div> </div> </li> </ol> <h3 id="6-db-폴더와-log-폴더-권한-변경">(6) db 폴더와 log 폴더 권한 변경</h3> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight">
<pre class="highlight"><code>/home/centos/pyBook/ch8&gt; sudo chmod 777 db
/home/centos/pyBook/ch8&gt; sudo chmod 666 db/db.sqlite3

/home/centos/pyBook/ch8&gt; sudo chmod 777 log
/home/centos/pyBook/ch8&gt; sudo chmod 666 log/mysite.log
</code></pre>  </div></div> <h2 id="3-nginx-설치">3. NGINX 설치</h2> <blockquote> <p>https://docs.nginx.com 사이트 참조. NGINX Plus &gt; Admin Guide &gt; Installing NGINX and NGINX Plus 로 이동하여 상세 정보 확인</p> </blockquote> <p>. NGINX 설치 시 선택 항목</p> <table> <thead> <tr> <th>선택항목</th> <th>선택</th> <th>가능한 다른 선택들</th> </tr> </thead> <tbody> <tr> <td>솔루션명</td> <td>NGINX Open Source</td> <td>NGINX Plus(유료)</td> </tr> <tr> <td>버전</td> <td>Stable</td> <td>Mainline(시험용 기능 포함)</td> </tr> <tr> <td>컴파일여부</td> <td>Prebuilt</td> <td>Compiling from Source</td> </tr> <tr> <td>서버 OS</td> <td>CentOs or RHEL</td> <td>Debian, Ubuntu, SUSE</td> </tr> <tr> <td>저장소</td> <td>NGINX 저장소 신규 생성</td> <td>OS 제공 기본 저장소 사용</td> </tr> </tbody> </table> <ol> <li>저장소 생성 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> $ sudo vi /etc/yum.repos.d/nginx.repo

 [nginx]
 name=nginx repo
 baseurl=http://nginx.org/packages/centos/8/$basearch/
 gpgcheck=0
 enabled=1
</code></pre>  </div> </div> </li> <li>저장소 업데이트 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> $ sudo yum update
</code></pre>  </div> </div> </li> <li>설치완료 후 nginx 가동 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> $ sudo nginx
</code></pre>  </div> </div> </li> <li>nginx 정상 가동 확인 <div class="language-plaintext highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> $ curl -I 127.0.0.1

 HTTP/1.1 200 OK
 Server: nginx/1.14.0 
</code></pre>  </div> </div> <ul> <li>200 OK가 나오면, 정상가동됨</li> </ul> </li> </ol> <h3 id="--nginx-명령-"><font color="red"> ✤ nginx 명령 </font></h3> <p>. nginx 가동 : <code class="language-plaintext highlighter-rouge notranslate">$ sudo nginx</code> <br> . nginx 정지 : <code class="language-plaintext highlighter-rouge notranslate">$ sudo nginx -s stop</code> <br> . nginx 재가동 : <code class="language-plaintext highlighter-rouge notranslate">$ sudo nginx -s reload</code> <br> . nginx 설정 파일 테스트 : <code class="language-plaintext highlighter-rouge notranslate">$ sudo nginx -t</code> <br> . nginx 도움말 : <code class="language-plaintext highlighter-rouge notranslate">$ sudo nginx -h</code></p> <h2 id="4-nginx-설정">4. NGINX 설정</h2> <blockquote> <p>설정파일 위치 : /etc/nginx/conf.d/</p> </blockquote> <div class="language-conf highlighter-rouge notranslate"><div class="highlight">
<pre class="highlight"><code>$ <span class="n">sudo</span> <span class="n">vim</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">conf</span>.<span class="n">d</span>/<span class="n">ch9_nginx</span>.<span class="n">conf</span>

<span class="n">server</span> {
    <span class="n">listen</span> <span class="m">8000</span>;
    <span class="n">server_name</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>;

    <span class="c"># access_log /var/log/nginx/codejob.co.kr_access.log;   // 이미 /etc/nginx/nginx.conf에 지정되어 있음.
</span>    <span class="c"># error_log /var/log/nginx/codejob.co.kr_error.log;
</span>    
    <span class="n">location</span> = /<span class="n">favicon</span>.<span class="n">ico</span> {<span class="n">access_log</span> <span class="n">off</span>; <span class="n">log_not_found</span> <span class="n">off</span>; }  
    <span class="c"># /favicon.ico 으로 요청이 들어오면, access_log 기록하지 않고, /favicon.ico 을 찾지 못해도 error_log 에 기록하지 않음
</span>
    <span class="n">location</span> /<span class="n">static</span>/ {
        <span class="n">root</span> /<span class="n">home</span>/<span class="n">centos</span>/<span class="n">pyBook</span>/<span class="n">ch9</span>/<span class="n">www_dir</span>; // 정적파일의 루트 디렉토리 지정
        <span class="c"># alias /home/centos/pyBook/ch9/www_dir/static/; // alias 디렉티브를 사용 할 수도 있음. path 끝에 '/'로 끝나야 함
</span>    }

    <span class="n">location</span> / {
        <span class="n">include</span> /<span class="n">home</span>/<span class="n">centos</span>/<span class="n">pyBook</span>/<span class="n">ch9</span>/<span class="n">www_dir</span>/<span class="n">uwsgi_params</span>; // 위의 <span class="n">URL</span> 외의 <span class="n">URL</span> 처리, <span class="n">uwsgi</span> 에 넘겨줄 파라미터 정의
        <span class="n">uwsgi_pass</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">8001</span>; //<span class="n">nginx</span> 에서 <span class="n">uwsgi</span> 프로그램으로 처리르 위임. 웹서버와 <span class="n">wsgi</span> 가 통신하기 위한 <span class="n">ip</span>:<span class="n">port</span> 설정
        <span class="c"># uwsgi_pass unix:///home/centos/pyBook/ch9/www_dir/ch9.sock; // 위의 작업을 UDS(unix domain socket) 방식을 이용해도 됨. 웹서버와 WAS 가 같은 H/W에 존재 할 때는 UDS 방법의 성능이 훨씬 우세함 
</span>    }
}

$ <span class="n">cp</span> /<span class="n">etc</span>/<span class="n">uwsgi</span>/<span class="n">nginx</span>/<span class="n">uwsgi_params</span> /<span class="n">home</span>/<span class="n">centos</span>/<span class="n">pyBook</span>/<span class="n">ch9</span>/<span class="n">www_dir</span>/  //<span class="n">uwsgi_params</span> 는 <span class="n">uwsgi</span> 를 설치 시 생성될 것임. 이 파일을 장고 프로젝트의 적절한 위치로 복사
</code></pre>  </div></div> <h2 id="5-uwsgi-설치">5. uWSGI 설치</h2> <blockquote> <p>uWSGI 공식문서 : <a href="http://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html">http://uwsgi-docs.readthedocs.io/en/latest/tutorials/Django_and_nginx.html</a> <br> 운영환경을 만들 때는 전역 설치를 하는 것이 일반적이므로, root 또는 sudo 권한으로 설치</p> </blockquote> <div class="language-plaintext highlighter-rouge notranslate"><div class="highlight">
<pre class="highlight"><code>$ sudo yum install python3-devel
$ sudo pip3 install uwsgi
</code></pre>  </div></div> <ul> <li>주의 : python3-devel (파이썬 라이브러리) 먼저 설치 후 uwsgi 설치</li> </ul> <h3 id="--uwsgi-명령-"><font color="red"> ✤ uwsgi 명령 </font></h3> <ul> <li>기동 : <code class="language-plaintext highlighter-rouge notranslate">$ uwsgi</code>
</li> <li>정지 : <code class="language-plaintext highlighter-rouge notranslate">$ uwsgi --stop pid-file</code>
</li> <li>재기동: <code class="language-plaintext highlighter-rouge notranslate">$ uwsgi --reload pid-file</code>
</li> <li>도움말: <code class="language-plaintext highlighter-rouge notranslate">$ uwsgi --help</code>
</li> </ul> <h2 id="6-uwsgi-설정">6. uWSGI 설정</h2> <blockquote> <p>장고 프로젝트별 하나의 설정파일 필요함 <br> vassals 는, 자식프로세스를 뜻하는 uWSGI 용어</p> </blockquote> <div class="language-ini highlighter-rouge notranslate"><div class="highlight">
<pre class="highlight"><code><span class="err">$</span> <span class="err">sudo</span> <span class="err">mkdir</span> <span class="err">-p</span> <span class="err">/etc/uwsgi/vassals</span>
<span class="err">$</span> <span class="err">sudo</span> <span class="err">vi</span> <span class="err">/etc/uwsgi/vassals/ch9_uwsgi.ini</span>

<span class="nn">[uwsgi]</span>
<span class="py">chdir</span> <span class="p">=</span> <span class="s">/home/centos/pyBook/ch9 # 장고의 베이스 디렉토리</span>
<span class="py">home</span> <span class="p">=</span> <span class="s">/home/centos/VENV/v3PyBook # 가상환경 사용 시, 가상환경의 루트 디렉토리 (가상환경 사용하지 않으면 생략)</span>
<span class="py">module</span> <span class="p">=</span> <span class="s">mysite.wsgi:application # wsgi.py 파일의 모듈 경로 및 application 변수</span>
<span class="py">socket</span> <span class="p">=</span> <span class="s">:8001 # 웹서버와 통신할 소켓의 포트 번호</span>
<span class="c"># socket = /home/centos/pyBook/ch9/www_dir/ch9.sock # 웹서버가 UDS 사용 시 소켓 파일의 경로. nginx 설정 파일의 소켓파일과 경로가 같음.
# chmod-socket = 666
</span><span class="py">master</span> <span class="p">=</span> <span class="s">True # 별도의 마스터 프로세스가 가동되도록 지정</span>
<span class="py">processes</span> <span class="p">=</span> <span class="s">5 # uwsgi 가동 시 자식 프로세스를 5개 생성</span>
<span class="py">pidfile</span> <span class="p">=</span> <span class="s">/tmp/ch9-master.pid # 마스터 프로세스 ID를 저장할 파일</span>
<span class="py">vacuum</span> <span class="p">=</span> <span class="s">True # 프로세스 종료 시 소켓파일을 포함하여 환경변수 클리어</span>
<span class="py">max-requests</span> <span class="p">=</span> <span class="s">5000 # 현 프로세스에서 처리할 최대 요청 개수 지정</span>
<span class="py">daemonize</span> <span class="p">=</span> <span class="s">/var/log/uwsgi/ch9.log # 백그라운드에서 프로세스가 실행되도록 데몬화하고 데몬에서 사용할 로그 파일을 지정</span>

<span class="err">$</span> <span class="err">sudo</span> <span class="err">touch</span> <span class="err">/var/log/uwsgi/ch9.log</span> <span class="c"># 설정파일에서 지정한 로그파일 생성
</span><span class="err">$</span> <span class="err">sudo</span> <span class="err">chmod</span> <span class="err">666</span> <span class="err">/var/log/uwsgi/ch9.log</span> <span class="c"># uwsgi 프로세스가 쓸 수 있도록 권한을 변경
</span></code></pre>  </div></div> <h2 id="7-작업-확인하기">7. 작업 확인하기</h2> <blockquote> <p>nginx는 루트권한으로 실행 해야 함 <br> uwsgi는 루트계정 및 일반사용자 계정으로도 실행 할 수 있음</p> </blockquote> <h3 id="1-uwsgi-emperor-모드">(1) uWSGI Emperor 모드</h3> <ul> <li>시스템 전역으로 uwsgi 프로그램을 설치 하였으므로, 루트 권한으로 실행</li> <li>루트 권한으로 실행시 모동 Emperor 모드로 실행함</li> <li> <font color="red"> Emperor 모드 : 설정파일 변경시 자동으로 프로세스 재가동 </font> </li> </ul> <ol> <li>nginx와 uwsgi 프로그램을 실행한다. <div class="language-bash highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo </span>nginx
<span class="c">#  이미 실행 중이라면, 아래의 명령 실행</span>
<span class="nv">$ </span><span class="nb">sudo </span>nginx <span class="nt">-s</span> reload
<span class="c"># uwsgi 서버 가동, uid,gid는 uwsgi 프로세스의 주인이 될 사용자와 그룹 아이디를 지정</span>
<span class="c"># uwsgi 명령에 옵션을 붙여 실행 할 수도 있지만, </span>
<span class="c"># *.ini 파일에 명령을 기록 후 *.ini 파일을 실행 시킬 수도 있음</span>
<span class="nv">$ </span><span class="nb">sudo </span>uwsgi <span class="nt">--emperor</span> /etc/uwsgi/vassals <span class="nt">--uid</span> centos <span class="nt">--gid</span> centos
</code></pre>  </div> </div> </li> <li>웹 브라우저에서 http://localhost:8000/ 을 요청하면, 프로젝트 메인화면이 실행된다.</li> </ol> <h3 id="2-uwsgi-일반모드">(2) uWSGI 일반모드</h3> <blockquote> <p>간단하게 사용하거나 소규모 프로젝트라면, Emperor 모드가 아닌 일반모드로 실행 할 수 있음 <br> 이 경우, 일반 사용자계정으로 설정파일 생성 후, 실행 해도 됨, 그래서 설정파일과 로그 파일을 장고 프로젝트 하위로 변경</p> </blockquote> <ol> <li>uWSGI 설정파일 장고프로젝트 하위에 작성 <div class="language-bash highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> <span class="nv">$ </span><span class="nb">cd</span> /home/centos/pyBook/ch9/www_dir
 <span class="nv">$ </span>vim ch9_uwsgi.ini

 <span class="c"># 하위는 *.ini 파일로, 내용은 daemonize 설정(로그 설정)을 빼고, 루트모드에서 실행 시와 같다.</span>
 <span class="o">[</span>uwsgi]
 chdir <span class="o">=</span> /home/centos/pyBook/ch9 <span class="c"># 장고의 베이스 디렉토리</span>
 home <span class="o">=</span> /home/centos/VENV/v3PyBook <span class="c"># 가상환경 사용 시, 가상환경의 루트 디렉토리 (가상환경 사용하지 않으면 생략)</span>
 module <span class="o">=</span> mysite.wsgi:application <span class="c"># wsgi.py 파일의 모듈 경로 및 application 변수</span>
 socket <span class="o">=</span> :8001 <span class="c"># 웹서버와 통신할 소켓의 포트 번호</span>
 <span class="c"># socket = /home/centos/pyBook/ch9/www_dir/ch9.sock # 웹서버가 UDS 사용 시 소켓 파일의 경로. nginx 설정 파일의 소켓파일과 경로가 같음.</span>
 <span class="c"># chmod-socket = 666</span>
 master <span class="o">=</span> True <span class="c"># 별도의 마스터 프로세스가 가동되도록 지정</span>
 processes <span class="o">=</span> 5 <span class="c"># uwsgi 가동 시 자식 프로세스를 5개 생성</span>
 pidfile <span class="o">=</span> /tmp/ch9-master.pid <span class="c"># 마스터 프로세스 ID를 저장할 파일</span>
 vacuum <span class="o">=</span> True <span class="c"># 프로세스 종료 시 소켓파일을 포함하여 환경변수 클리어</span>
 max-requests <span class="o">=</span> 5000 <span class="c"># 현 프로세스에서 처리할 최대 요청 개수 지정</span>
 daemonize <span class="o">=</span> /home/centos/pyBook/ch9/www_dir/ch9.log <span class="c"># 백그라운드에서 프로세스가 실행되도록 데몬화하고 데몬에서 사용할 로그 파일을 지정</span>

 <span class="c"># 로그파일을 생성하고 권한을 변경</span>
 <span class="nv">$ </span><span class="nb">touch</span> /home/centos/pyBook/ch9/www_dir/ch9.log
 <span class="nv">$ </span><span class="nb">chmod </span>666 /home/centos/pyBook/ch9/www_dir/ch9.log
</code></pre>  </div> </div> </li> <li> <p>nginx 와 uWSGI 프로그램 가동 <br> . 일반모드이므로, uwsgi도 일반 사용자로 실행</p> <div class="language-bash highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> <span class="nv">$ </span><span class="nb">cd</span> /home/centos/pyBook/ch9/
 <span class="nv">$ </span>uwsgi <span class="nt">--ini</span> www_dir/ch9_uwsgi.ini

 <span class="c"># uwsgi 중지 명령</span>
 <span class="nv">$ </span>uwsgi <span class="nt">--stop</span> /tmp/ch9-master.pid
</code></pre>  </div> </div> </li> <li>동작 확인 <ul> <li>웹브라우저로 http://localhost:8000/을 호출하여, 프로젝트의 메인화면이 실행되는지 확인</li> </ul> </li> </ol> <h3 id="3-유닉스-도메인-소켓-사용">(3) 유닉스 도메인 소켓 사용</h3> <blockquote> <p>웹서버와 WAS가 동일한 H/W 에서 실행될 때는, 네트워크 모듈을 통한 소켓통신이 아니라, 파일 시스템을 사용하여 소켓 통신을 하는 것이 더 성능이 좋다. <br> 파일 시스템을 사용한 소켓 통신중 하나가 <strong>유닉스 도메인 소켓(UDS)</strong> 방식이다. <br> uWSGI 도 UDS 방식을 지원한다.</p> </blockquote> <ol> <li>NGINX 설정 파일 수정 <div class="language-conf highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> $ <span class="n">sudo</span> <span class="n">vim</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">conf</span>.<span class="n">d</span>/<span class="n">ch9_nginx</span>.<span class="n">conf</span>

 <span class="n">server</span> {
     (생략)
     <span class="n">location</span> / {
         <span class="n">include</span> /<span class="n">home</span>/<span class="n">centos</span>/<span class="n">pyBook</span>/<span class="n">ch9</span>/<span class="n">www_dir</span>/<span class="n">uwsgi_params</span>;
         <span class="c"># uwsgi_pass 127.0.0.1:8001
</span>         <span class="n">uwsgi_pass</span> <span class="n">unix</span>:///<span class="n">home</span>/<span class="n">centos</span>/<span class="n">pyBook</span>/<span class="n">ch9</span>/<span class="n">www_dir</span>/<span class="n">ch9</span>.<span class="n">sock</span>;
     }
 }
</code></pre>  </div> </div> <ul> <li>uwsgi_pass 를 ip:포트 방식이 아닌 소켓의 경로를 지정하는 것이 핵심</li> </ul> </li> <li>uWSGI 설정 파일 수정 (Emperor 모드 예제) <div class="language-ini highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> <span class="err">$</span> <span class="err">cd</span> <span class="err">/etc/uwsgi/vassals</span>
 <span class="err">$</span> <span class="err">sudo</span> <span class="err">vim</span> <span class="err">ch9_uwsgi.ini</span>
    
 <span class="nn">[uwsgi]</span>
 <span class="py">socket</span> <span class="p">=</span> <span class="s">/home/centos/pyBook/ch9/www_dir/ch9.sock</span>
 <span class="py">chmod-socket</span> <span class="p">=</span> <span class="s">666</span>
 <span class="err">(아래내용</span> <span class="err">동일)</span>
</code></pre>  </div> </div> </li> <li>uWSGI 프로그램을 실행 시키기 위한 *.ini 파일 생성 <blockquote> <p><code class="language-plaintext highlighter-rouge notranslate">$ sudo uwsgi --emperor /etc/uwsgi/vassals --uid centos --gid centos</code> 로 *.ini 파일없이 실행 가능함</p> </blockquote> <div class="language-ini highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> <span class="err">$</span> <span class="err">cd</span> <span class="err">/etc/uwsgi</span>
 <span class="err">$</span> <span class="err">sudo</span> <span class="err">vim</span> <span class="err">uwsgi_emperor.ini</span>

 <span class="nn">[uwsgi]</span>
 <span class="py">emperor</span> <span class="p">=</span> <span class="s">/etc/uwsgi/vassals</span>
 <span class="py">uid</span> <span class="p">=</span> <span class="s">centos</span>
 <span class="py">gid</span> <span class="p">=</span> <span class="s">centos</span>
 <span class="py">master</span> <span class="p">=</span> <span class="s">True</span>
 <span class="py">pidfile</span> <span class="p">=</span> <span class="s">/tmp/emperor.pid</span>
 <span class="py">vacuum</span> <span class="p">=</span> <span class="s">True</span>
 <span class="py">daemonize</span> <span class="p">=</span> <span class="s">/var/log/uwsgi/emperor.log</span>
</code></pre>  </div> </div> </li> <li>ninx와 uwsgi 프로그램 실행 <div class="language-bash highlighter-rouge notranslate">
<div class="highlight">
<pre class="highlight"><code> <span class="nv">$ </span><span class="nb">sudo </span>nginx
 <span class="nv">$ </span><span class="nb">sudo </span>uwsgi <span class="nt">--ini</span> /etc/uwsgi/uwsgi_emperor.ini

 <span class="c"># 중지명령</span>
 <span class="nv">$ </span><span class="nb">sudo </span>nginx <span class="nt">-s</span> stop
 <span class="nv">$ </span><span class="nb">sudo </span>uwsgi <span class="nt">--stop</span> /tmp/emperor.pid
</code></pre>  </div> </div> </li> <li>동작 확인 <br> . 웹브라우저에서 ‘http://localhost:8000' 을 호출하면 프로젝트 메인화면이 실행됨</li> </ol> </div> </div> <hr> <div class="copyright text-center text-gray" role="contentinfo"> <i class="fa fa-copyright"></i> <span class="time">2020-2021,</span> <a class="text-gray" href="https://github.com/82iirriiss" rel="noreferrer" target="_blank">82iirriiss</a> Revision <a class="text-gray" href="https://github.com/82iirriiss/82iirriiss.github.io/commit/bd0a765f0a21ff3dd0114128ca8b2b6619a4a41b" title="bd0a765f0a21ff3dd0114128ca8b2b6619a4a41b" rel="noreferrer" target="_blank">bd0a765</a> <br> <div class="generator"> Built with <a href="https://pages.github.com" rel="noreferrer" target="_blank" title="github-pages v209">GitHub Pages</a> using a <a href="https://github.com/rundocs/jekyll-rtd-theme" rel="noreferrer" target="_blank" title="jekyll-rtd-theme v2.0.10">theme</a> provided by <a href="https://rundocs.io" rel="noreferrer" target="_blank">RunDocs</a>. </div> </div> </div> </div> <div class="addons-wrap d-flex flex-column overflow-y-auto"> <div class="status d-flex flex-justify-between p-2"> <div class="title p-1"> <i class="fa fa-book"></i> 윤미의 개발 블로그 </div> <div class="branch p-1"> <span class="name"> gh-pages </span> <i class="fa fa-caret-down"></i> </div> </div> <div class="addons d-flex flex-column height-full p-2 d-none"> <dl> <dt>GitHub</dt> <dd> <a href="https://github.com/82iirriiss/82iirriiss.github.io" title="Stars: 0"> <i class="fa fa-github"></i> Homepage </a> </dd> <dd> <a href="https://github.com/82iirriiss/82iirriiss.github.io/issues" title="Open issues: 0"> <i class="fa fa-question-circle-o"></i> Issues </a> </dd> <dd> <a href="https://github.com/82iirriiss/82iirriiss.github.io/zipball/gh-pages" title="Size: 12005 Kb"> <i class="fa fa-download"></i> Download </a> </dd> </dl> <hr> <div class="license f6 pb-2"> This <a href="/" title="윤미의 개발 블로그">Software</a> is under the terms of <a href="https://github.com/82iirriiss/82iirriiss.github.io">MIT License</a>. </div> </div> </div> <script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/gh/rundocs/jekyll-rtd-theme@2.0.10/assets/js/theme.min.js"></script> </body> </html>
